<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Village Grocery Delivery</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#f4f4f4,#e8f5e9);
  margin:0;
  padding-bottom:90px;
}

/* HEADER */
header {
  background:#2e7d32;
  color:#fff;
  padding:14px 16px;
  text-align:left;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
header.admin-active {
  background:#1976D2 !important;
}

.container {
  padding:12px;
  max-width:480px;
  margin:10px auto 0 auto;
}

/* PRODUCT CARD */
.product {
  background:#fff;
  display:flex;
  align-items:center;
  padding:12px;
  margin-bottom:12px;
  border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  position:relative;
}

.product .tag {
  position:absolute;
  top:8px;
  left:12px;
  background:#ffcc80;
  color:#4e342e;
  font-size:10px;
  padding:2px 6px;
  border-radius:10px;
}

.product img {
  width:72px;
  height:72px;
  border-radius:12px;
  margin-right:12px;
  object-fit:cover;
}

.product h4 {
  margin:0;
  font-size:16px;
}

.product p {
  margin:5px 0;
  color:#2e7d32;
  font-weight:bold;
}

/* FORM / CARD */
.form {
  background:#fff;
  padding:12px 14px;
  border-radius:14px;
  margin-top:15px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.form h4 {
  margin:0 0 10px 0;
}

.form label {
  font-size:13px;
  font-weight:bold;
  display:block;
  margin-bottom:4px;
}

.form input,
.form textarea {
  width:100%;
  padding:9px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #cfd8dc;
  font-size:14px;
  background:#fafafa;
}

.form input:focus,
.form textarea:focus {
  outline:none;
  border-color:#2e7d32;
  box-shadow:0 0 0 1px rgba(46,125,50,0.2);
}

.required {
  color:#e53935;
  margin-left:2px;
  font-size:13px;
}

.hint {
  font-size:11px;
  color:#777;
  margin-top:-6px;
  margin-bottom:8px;
}

.error {
  font-size:12px;
  color:#e53935;
  display:none;
}

/* CART BAR */
.cart-bar {
  position:fixed;
  bottom:0;
  width:100%;
  background:#ffffff;
  padding:8px 10px;
  box-shadow:0 -3px 10px rgba(0,0,0,.25);
}

.cart-bar button {
  width:100%;
  background:linear-gradient(90deg,#2e7d32,#43a047);
  color:#fff;
  border:none;
  padding:12px;
  font-size:16px;
  border-radius:30px;
  cursor:pointer;
}

/* FLOATING CART BUTTON (TOP-RIGHT) */
#floatingCart {
  position:fixed;
  top:70px;
  right:16px;
  width:46px;
  height:46px;
  border-radius:50%;
  background:#2e7d32;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.25);
  cursor:pointer;
  z-index:1500;
}

/* ADMIN PANELS */
#adminPanel {
  position:fixed;
  top:20px;
  right:20px;
  background:#fff;
  padding:15px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  z-index:1600;
  display:none;
  min-width:200px;
}

#adminPanel button {
  width:100%;
  margin-bottom:8px;
  padding:8px;
  border-radius:4px;
  border:none;
  cursor:pointer;
}

#loginPanel {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:30px;
  border-radius:12px;
  box-shadow:0 8px 32px rgba(0,0,0,0.3);
  z-index:2000;
  display:none;
  text-align:center;
  min-width:280px;
}

#loginPanel input {
  width:90%;
  padding:12px;
  margin:10px 0 20px 0;
  border:2px solid #ddd;
  border-radius:6px;
  font-size:16px;
}

#loginPanel button {
  width:100%;
  padding:12px;
  background:#2e7d32;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}

.btn-admin { background:#2196F3; color:#fff; }
#outOfStock.btn-admin { background:#f44336; }
#inStock.btn-admin { background:#4CAF50; }

/* admin controls hidden by default, visible in admin-mode */
.admin-controls {
  display:none;
  margin-left:10px;
}
.admin-mode .admin-controls {
  display:inline-block !important;
}

/* QTY PILL */
.qty-area {
  margin-left:auto;
  display:flex;
  align-items:center;
}
.add-btn,
.qty-pill {
  border-radius:999px;
  padding:6px 14px;
  border:1px solid #cfd8dc;
  font-size:13px;
  cursor:pointer;
  background:#fff;
}
.add-btn {
  color:#2e7d32;
  font-weight:bold;
}
.qty-pill {
  display:flex;
  align-items:center;
  gap:10px;
}
.qty-pill button {
  width:22px;
  height:22px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  font-size:16px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.qty-minus {
  background:#eeeeee;
}
.qty-plus {
  background:#2e7d32;
  color:#fff;
}
</style>
</head>

<body>

<!-- ADMIN LOGIN MODAL -->
<div id="loginPanel">
  <h3>üîê Admin Login</h3>
  <input type="password" id="adminPassword" placeholder="Enter Password">
  <button onclick="checkAdminLogin()">Login</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <h4>üîß Admin Panel</h4>
  <button id="toggleAdmin" class="btn-admin" onclick="toggleAdminMode()">Exit Admin</button>
  <button id="outOfStock" class="btn-admin" onclick="markAllOutOfStock()">Mark All Out of Stock</button>
  <button id="inStock" class="btn-admin" onclick="restockAll()">Restock All</button>
</div>

<header>
  <div onclick="showAdminLogin()">Village Grocery ‚Äì Home Delivery</div>
  <div style="font-size:13px;display:flex;align-items:center;gap:4px;">
    üõí <span id="headerCartCount">0</span>
  </div>
</header>

<!-- Floating cart button -->
<div id="floatingCart" onclick="scrollToCart()">üõí</div>

<div class="container">

  <!-- Search -->
  <div class="form">
    <h4>üîç Search Products</h4>
    <input type="text" id="searchInput" placeholder="Type rice, oil, sugar...">
  </div>

  <!-- Products will be rendered here -->
  <div id="productsContainer"></div>

  <!-- Cart -->
  <div class="form" id="cartSection">
    <h4>üõí Cart</h4>
    <ul id="cartList"></ul>
    <p><strong>Total: ‚Çπ<span id="total">0</span></strong></p>
  </div>

  <!-- Customer Form -->
  <div class="form">
    <h4>üì¶ Delivery Details</h4>

    <label for="name">Name<span class="required">*</span></label>
    <input type="text" id="name" placeholder="Your Name">

    <label for="mobile">Mobile Number<span class="required">*</span></label>
    <input type="tel" id="mobile" placeholder="10-digit mobile">
    <div class="hint">Only 10 digits, without country code. Example: 9876543210</div>
    <div id="mobileError" class="error">Enter a valid 10‚Äëdigit mobile number.</div>

    <button type="button" id="locBtn" style="width:100%;margin-bottom:8px;padding:8px;border-radius:8px;border:none;background:#eeeeee;cursor:pointer;font-size:13px;">
      üìç Use my current location
    </button>
    <div id="locInfo" class="hint"></div>

    <label for="address">Delivery Address<span class="required">*</span></label>
    <textarea id="address" rows="3" placeholder="House / Street / Village / Pincode"></textarea>
    <div id="addressError" class="error">Address is required.</div>
  </div>

</div>

<div class="cart-bar">
  <button onclick="placeOrder()">Place Order (Cash on Delivery)</button>
</div>

<script>
let cart = {};
let total = 0;
const phone = "916380176168";
const ADMIN_PASSWORD = "admin123";
let isAdminMode = false;
let customerLocation = null;

/* 50 PRODUCTS */
const products = [
  {name:'Rice (1 Kg)',price:55,tag:'Staple',img:'https://images.pexels.com/photos/4110251/pexels-photo-4110251.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Rice (5 Kg)',price:260,tag:'Staple',img:'https://images.pexels.com/photos/4110251/pexels-photo-4110251.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Idli Rice (1 Kg)',price:60,tag:'Staple',img:'https://images.pexels.com/photos/4110251/pexels-photo-4110251.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Wheat Flour (1 Kg)',price:48,tag:'Staple',img:'https://images.pexels.com/photos/3738106/pexels-photo-3738106.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Maida (1 Kg)',price:42,tag:'Staple',img:'https://images.pexels.com/photos/3738106/pexels-photo-3738106.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Ragi Flour (1 Kg)',price:55,tag:'Healthy',img:'https://images.pexels.com/photos/3738106/pexels-photo-3738106.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Sugar (1 Kg)',price:45,tag:'Popular',img:'https://images.pexels.com/photos/1854664/pexels-photo-1854664.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Jaggery (1 Kg)',price:70,tag:'Healthy',img:'https://images.pexels.com/photos/3738024/pexels-photo-3738024.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Salt (1 Kg)',price:20,tag:'Daily Use',img:'https://images.pexels.com/photos/4110251/pexels-photo-4110251.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Rock Salt (500 g)',price:35,tag:'Healthy',img:'https://images.pexels.com/photos/4110251/pexels-photo-4110251.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Cooking Oil (1 L)',price:160,tag:'Daily Use',img:'https://images.pexels.com/photos/1459343/pexels-photo-1459343.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Groundnut Oil (1 L)',price:190,tag:'Cold Pressed',img:'https://images.pexels.com/photos/1459343/pexels-photo-1459343.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Sunflower Oil (1 L)',price:165,tag:'Daily Use',img:'https://images.pexels.com/photos/1459343/pexels-photo-1459343.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Gingelly Oil (500 ml)',price:140,tag:'Special',img:'https://images.pexels.com/photos/1459343/pexels-photo-1459343.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Ghee (500 ml)',price:260,tag:'Premium',img:'https://images.pexels.com/photos/1459343/pexels-photo-1459343.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Toor Dal (1 Kg)',price:130,tag:'Dal',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Urid Dal (1 Kg)',price:120,tag:'Dal',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Chana Dal (1 Kg)',price:95,tag:'Dal',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Moong Dal (1 Kg)',price:110,tag:'Dal',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Masoor Dal (1 Kg)',price:100,tag:'Dal',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Chana (1 Kg)',price:85,tag:'Pulses',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Rajma (1 Kg)',price:120,tag:'Pulses',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Green Peas Dry (1 Kg)',price:95,tag:'Pulses',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Horse Gram (1 Kg)',price:70,tag:'Healthy',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Black Chana (1 Kg)',price:90,tag:'Pulses',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Tea Powder (250 g)',price:95,tag:'Beverage',img:'https://images.pexels.com/photos/1417945/pexels-photo-1417945.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Coffee Powder (200 g)',price:120,tag:'Beverage',img:'https://images.pexels.com/photos/585750/pexels-photo-585750.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Sugar-free Sweetener',price:180,tag:'Health',img:'https://images.pexels.com/photos/1854664/pexels-photo-1854664.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Boost (500 g)',price:230,tag:'Health Drink',img:'https://images.pexels.com/photos/4109992/pexels-photo-4109992.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Horlicks (500 g)',price:220,tag:'Health Drink',img:'https://images.pexels.com/photos/4109992/pexels-photo-4109992.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Bath Soap (Lux)',price:30,tag:'Toiletries',img:'https://images.pexels.com/photos/1029041/pexels-photo-1029041.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Bath Soap (Hamam)',price:28,tag:'Toiletries',img:'https://images.pexels.com/photos/1029041/pexels-photo-1029041.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Shampoo Sachets (10 pcs)',price:40,tag:'Toiletries',img:'https://images.pexels.com/photos/3738364/pexels-photo-3738364.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Toothpaste (Colgate 100 g)',price:55,tag:'Toiletries',img:'https://images.pexels.com/photos/4198202/pexels-photo-4198202.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Toothbrush (1 pc)',price:25,tag:'Toiletries',img:'https://images.pexels.com/photos/4198202/pexels-photo-4198202.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Washing Powder (1 Kg)',price:75,tag:'Home Care',img:'https://images.pexels.com/photos/3965558/pexels-photo-3965558.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Dishwash Bar (3 pcs)',price:40,tag:'Home Care',img:'https://images.pexels.com/photos/4108710/pexels-photo-4108710.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Floor Cleaner (500 ml)',price:85,tag:'Home Care',img:'https://images.pexels.com/photos/4108710/pexels-photo-4108710.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Phenyl (1 L)',price:70,tag:'Home Care',img:'https://images.pexels.com/photos/4108710/pexels-photo-4108710.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Garbage Bags (Small, 30 pcs)',price:65,tag:'Home Care',img:'https://images.pexels.com/photos/3738102/pexels-photo-3738102.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Biscuits (Marie 200 g)',price:30,tag:'Snacks',img:'https://images.pexels.com/photos/1028716/pexels-photo-1028716.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Biscuits (Good Day 200 g)',price:35,tag:'Snacks',img:'https://images.pexels.com/photos/1028716/pexels-photo-1028716.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Rusk (200 g)',price:40,tag:'Snacks',img:'https://images.pexels.com/photos/4109992/pexels-photo-4109992.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Noodles (Masala, 4 pcs)',price:55,tag:'Snacks',img:'https://images.pexels.com/photos/4198028/pexels-photo-4198028.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Vermicelli (500 g)',price:40,tag:'Snacks',img:'https://images.pexels.com/photos/4198028/pexels-photo-4198028.jpeg?auto=compress&cs=tinysrgb&w=800'},

  {name:'Onion (1 Kg)',price:40,tag:'Veg',img:'https://images.pexels.com/photos/143133/pexels-photo-143133.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Potato (1 Kg)',price:35,tag:'Veg',img:'https://images.pexels.com/photos/143133/pexels-photo-143133.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Tomato (1 Kg)',price:30,tag:'Veg',img:'https://images.pexels.com/photos/143133/pexels-photo-143133.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Green Chilli (100 g)',price:15,tag:'Veg',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'},
  {name:'Coriander Leaves (1 bunch)',price:10,tag:'Veg',img:'https://images.pexels.com/photos/4198020/pexels-photo-4198020.jpeg?auto=compress&cs=tinysrgb&w=800'}
];

/* STOCK STATUS */
let stockStatus = {};
products.forEach(p => { stockStatus[p.name] = true; });

function scrollToCart() {
  const cartSection = document.getElementById('cartSection');
  if (cartSection) cartSection.scrollIntoView({ behavior:'smooth' });
}

/* ADMIN (same as earlier) */
function showAdminLogin() {
  document.getElementById('loginPanel').style.display = 'block';
  document.body.style.overflow = 'hidden';
}
function checkAdminLogin() {
  const password = document.getElementById('adminPassword').value;
  if (password === ADMIN_PASSWORD) {
    document.getElementById('loginPanel').style.display = 'none';
    document.body.style.overflow = 'auto';
    toggleAdminMode();
  } else {
    alert('‚ùå Wrong Password!');
    document.getElementById('adminPassword').value = '';
  }
}
document.getElementById('loginPanel').onclick = e => e.stopPropagation();
document.body.onclick = function(e){
  if (e.target === document.getElementById('loginPanel')) {
    document.getElementById('loginPanel').style.display='none';
    document.body.style.overflow='auto';
  }
};
function toggleAdminMode() {
  isAdminMode = !isAdminMode;
  document.body.classList.toggle('admin-mode', isAdminMode);
  const adminPanel = document.getElementById('adminPanel');
  const toggleBtn = document.getElementById('toggleAdmin');
  const header = document.querySelector('header');
  if (isAdminMode) {
    adminPanel.style.display='block';
    toggleBtn.textContent='Exit Admin';
    header.classList.add('admin-active');
  } else {
    adminPanel.style.display='none';
    toggleBtn.textContent='Enter Admin';
    header.classList.remove('admin-active');
  }
  updateProductButtons();
}
function toggleStock(item){ if(isAdminMode){ stockStatus[item]=!stockStatus[item]; updateProductButtons(); } }
function markAllOutOfStock(){ Object.keys(stockStatus).forEach(i=>stockStatus[i]=false); updateProductButtons(); }
function restockAll(){ Object.keys(stockStatus).forEach(i=>stockStatus[i]=true); updateProductButtons(); }

/* RENDER & CART */
function renderProducts(filterText='') {
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';
  const text = filterText.toLowerCase();

  products
    .filter(p => p.name.toLowerCase().includes(text))
    .forEach(p => {
      const div = document.createElement('div');
      div.className='product';
      div.dataset.product=p.name;
      const priceId='price-'+p.name.toLowerCase().replace(/[^a-z0-9]/g,'-');

      div.innerHTML = `
        <span class="tag">${p.tag || ''}</span>
        <img src="${p.img}" alt="${p.name}">
        <div>
          <h4>${p.name}</h4>
          <p id="${priceId}">‚Çπ${p.price}</p>
        </div>
        <div class="admin-controls">
          <button onclick="toggleStock('${p.name}')">Toggle Stock</button>
        </div>
        <div class="qty-area" data-item="${p.name}">
          <button class="add-btn" onclick="addToCart('${p.name}',${p.price})">Add</button>
          <div class="qty-pill" style="display:none;">
            <button class="qty-minus" onclick="changeQty('${p.name}',-1)">‚àí</button>
            <span class="qty-value">1</span>
            <button class="qty-plus" onclick="changeQty('${p.name}',1)">+</button>
          </div>
        </div>
      `;
      container.appendChild(div);
    });

  updateProductButtons();
}
document.getElementById('searchInput').addEventListener('input',function(){
  renderProducts(this.value);
});

function addToCart(item, price) {
  if (!stockStatus[item]) { alert(`${item} is out of stock!`); return; }
  if (!cart[item]) cart[item]={price,qty:1}; else cart[item].qty+=1;
  updateQtyUI(item);
  updateCartUI();
}
function changeQty(item, delta) {
  if (!cart[item]) return;
  cart[item].qty += delta;
  if (cart[item].qty <= 0) delete cart[item];
  updateQtyUI(item);
  updateCartUI();
}
function updateQtyUI(item) {
  const sel = `.qty-area[data-item="${CSS.escape(item)}"]`;
  const area = document.querySelector(sel);
  if (!area) return;
  const addBtn = area.querySelector('.add-btn');
  const pill   = area.querySelector('.qty-pill');
  const span   = area.querySelector('.qty-value');
  if (cart[item]) {
    addBtn.style.display='none';
    pill.style.display='flex';
    span.textContent = cart[item].qty;
  } else {
    addBtn.style.display='inline-block';
    pill.style.display='none';
  }
}
function updateProductButtons() {
  document.querySelectorAll('.add-btn').forEach(btn=>{
    const product = btn.closest('.product').dataset.product;
    const priceId = `price-${product.toLowerCase().replace(/[^a-z0-9]/g,'-')}`;
    const priceEl = document.getElementById(priceId);
    if (!stockStatus[product]) {
      btn.disabled = true;
      btn.textContent = 'Out';
      btn.style.background='#cfd8dc';
      btn.style.color='#555';
      if (priceEl) {
        priceEl.innerHTML = priceEl.innerHTML.replace(/<span[^>]*>.*<\/span>$/,'') +
          ' <span style="color:#f44336;">(Out of Stock)</span>';
      }
    } else {
      btn.disabled = false;
      btn.textContent = 'Add';
      btn.style.background='#fff';
      btn.style.color='#2e7d32';
      if (priceEl) {
        priceEl.innerHTML = priceEl.innerHTML.replace(/<span[^>]*>.*<\/span>$/,'');
      }
    }
  });
}
function updateCartUI() {
  const cartList = document.getElementById("cartList");
  const totalEl = document.getElementById("total");
  const headerCartCount = document.getElementById("headerCartCount");
  const floatingCart = document.getElementById("floatingCart");

  cartList.innerHTML='';
  total=0;
  let itemCount=0;
  for (let item in cart){
    const li=document.createElement('li');
    li.textContent = `${item} √ó ${cart[item].qty} ‚Äî ‚Çπ${cart[item].price*cart[item].qty}`;
    cartList.appendChild(li);
    total += cart[item].price*cart[item].qty;
    itemCount += cart[item].qty;
  }
  totalEl.textContent = total;
  headerCartCount.textContent = itemCount;
  floatingCart.textContent = itemCount>0 ? itemCount : 'üõí';
}

/* validation */
function validateMobile(mobile){ return mobile.replace(/\D/g,'').length===10; }
document.getElementById('mobile').addEventListener('blur',function(){
  const el=document.getElementById('mobileError');
  const v=this.value.trim();
  el.style.display = (!validateMobile(v) && v!=="") ? 'block':'none';
});

/* location */
document.getElementById('locBtn').addEventListener('click',function(){
  const info=document.getElementById('locInfo');
  if(!('geolocation' in navigator)){
    info.textContent='Location not supported on this device.';
    return;
  }
  info.textContent='Getting location‚Ä¶';
  navigator.geolocation.getCurrentPosition(
    pos=>{
      const lat=pos.coords.latitude.toFixed(6);
      const lng=pos.coords.longitude.toFixed(6);
      customerLocation={lat,lng};
      info.textContent=`Location captured: ${lat}, ${lng}`;
    },
    err=>{
      info.textContent='Could not get location (permission denied or error).';
      console.error(err);
    },
    {enableHighAccuracy:true,timeout:10000,maximumAge:0}
  );
});

/* place order */
function placeOrder(){
  const name=document.getElementById('name').value.trim();
  const mobile=document.getElementById('mobile').value.trim();
  const address=document.getElementById('address').value.trim();
  const mobileErr=document.getElementById('mobileError');
  const addressErr=document.getElementById('addressError');
  let hasError=false;

  if(!name){ alert('Please enter your name.'); hasError=true; }
  if(!validateMobile(mobile)){ mobileErr.style.display='block'; hasError=true; } else mobileErr.style.display='none';
  if(!address){ addressErr.style.display='block'; hasError=true; } else addressErr.style.display='none';
  if(Object.keys(cart).length===0){ alert('Please add at least one item to the cart.'); hasError=true; }
  if(hasError) return;

  let itemsText=''; for(let item in cart){
    itemsText += `${item} √ó ${cart[item].qty} ‚Äî ‚Çπ${cart[item].price*cart[item].qty}\n`;
  }
  let locationText='';
  if(customerLocation){
    locationText =
      "\nüìç Location: "+customerLocation.lat+", "+customerLocation.lng+
      "\nüîó Map: https://www.google.com/maps?q="+customerLocation.lat+","+customerLocation.lng+"\n";
  }
  let message =
    "üõí *New Grocery Order*\n\n"+
    "üë§ Name: "+name+"\n"+
    "üìû Mobile: "+mobile+"\n"+
    "üè† Address: "+address+"\n"+
    locationText+
    "\nüì¶ Items:\n"+itemsText+
    "\nüí∞ Total: ‚Çπ"+total+
    "\nüöö Payment: Cash on Delivery";

  window.open("https://wa.me/"+phone+"?text="+encodeURIComponent(message),"_blank");

  cart={};
  total=0;
  products.forEach(p=>updateQtyUI(p.name));
  updateCartUI();
}

/* init */
renderProducts();
</script>

</body>
</html>
