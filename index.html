<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Village Grocery Delivery</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#f4f4f4,#e8f5e9);
  margin:0;padding-bottom:90px;
}
header{
  background:#2e7d32;color:#fff;
  padding:14px 16px;
  display:flex;justify-content:space-between;align-items:center;
}
.container{max-width:480px;margin:auto;padding:12px;}

.form{
  background:#fff;padding:12px;margin-bottom:15px;
  border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.form input,.form textarea{
  width:100%;padding:9px;margin-bottom:8px;
  border-radius:8px;border:1px solid #cfd8dc;
}

.error{color:#e53935;font-size:12px;display:none}

.product{
  background:#fff;display:flex;align-items:center;
  padding:12px;margin-bottom:12px;border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.product img{
  width:72px;height:72px;border-radius:12px;
  margin-right:12px;object-fit:cover;
}
.product h4{margin:0;font-size:16px}
.product p{margin:5px 0;color:#2e7d32;font-weight:bold}

.qty-area{margin-left:auto;display:flex;align-items:center}
.add-btn,.qty-pill{
  border-radius:999px;padding:6px 14px;
  border:1px solid #cfd8dc;background:#fff;cursor:pointer;
}
.qty-pill{display:none;gap:10px;align-items:center}
.qty-pill button{
  width:22px;height:22px;border-radius:50%;
  border:none;font-size:16px;cursor:pointer;
}
.qty-plus{background:#2e7d32;color:#fff}
.qty-minus{background:#eee}

.cart-bar{
  position:fixed;bottom:0;width:100%;
  background:#fff;padding:8px;
  box-shadow:0 -3px 10px rgba(0,0,0,.25);
}
.cart-bar button{
  width:100%;padding:12px;border:none;border-radius:30px;
  background:linear-gradient(90deg,#2e7d32,#43a047);
  color:#fff;font-size:16px;
}
</style>
</head>

<body>

<header>
  <div>Village Grocery</div>
  <div>üõí <span id="cartCount">0</span></div>
</header>

<div class="container">

<div id="products"></div>

<div class="form">
  <h4>üõí Cart</h4>
  <ul id="cartList"></ul>
  <strong>Total ‚Çπ<span id="total">0</span></strong>
</div>

<div class="form">
  <h4>üì¶ Delivery</h4>
  <input id="name" placeholder="Name *">
  <input id="mobile" placeholder="Mobile *">
  <textarea id="address" placeholder="Address *"></textarea>
  <button onclick="getLocation()">üìç Use My Location</button>
  <div id="locInfo" style="font-size:12px"></div>
</div>

</div>

<div class="cart-bar">
  <button onclick="placeOrder()">Place Order</button>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCYDLsQLFvuTV1N0mXtZFVYcSQqOkGfCrE",
  authDomain: "grocery-orders-3ce26.firebaseapp.com",
  projectId: "grocery-orders-3ce26",
  storageBucket: "grocery-orders-3ce26.appspot.com",
  messagingSenderId: "786501136156",
  appId: "1:786501136156:web:9277a2f7ef937deff1d4d9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// PRODUCTS
const productsData=[
 {name:'Rice (1kg)',price:55,img:'https://images.pexels.com/photos/4110251/pexels-photo-4110251.jpeg'},
 {name:'Oil (1L)',price:160,img:'https://images.pexels.com/photos/1459343/pexels-photo-1459343.jpeg'},
 {name:'Soap',price:30,img:'https://images.pexels.com/photos/1029041/pexels-photo-1029041.jpeg'}
];

let cart={},location=null;

const products=document.getElementById("products");

productsData.forEach(p=>{
 products.innerHTML+=`
 <div class="product">
  <img src="${p.img}">
  <div>
    <h4>${p.name}</h4>
    <p>‚Çπ${p.price}</p>
  </div>
  <div class="qty-area">
    <button class="add-btn" onclick="add('${p.name}',${p.price})">Add</button>
  </div>
 </div>`;
});

window.add=(name,price)=>{
 cart[name]=cart[name]?{price,qty:cart[name].qty+1}:{price,qty:1};
 renderCart();
};

function renderCart(){
 cartList.innerHTML="";let total=0,count=0;
 for(let i in cart){
  total+=cart[i].price*cart[i].qty;
  count+=cart[i].qty;
  cartList.innerHTML+=`<li>${i} √ó ${cart[i].qty}</li>`;
 }
 document.getElementById("total").textContent=total;
 document.getElementById("cartCount").textContent=count;
}

window.getLocation=()=>{
 navigator.geolocation.getCurrentPosition(p=>{
  location={lat:p.coords.latitude,lng:p.coords.longitude};
  locInfo.textContent=`Location saved`;
 });
};

window.placeOrder=async ()=>{
 const name=document.getElementById("name").value.trim();
 const mobile=document.getElementById("mobile").value.trim();
 const address=document.getElementById("address").value.trim();

 if(!name||!mobile||!address||!location||Object.keys(cart).length===0){
  alert("Fill all details");
  return;
 }

 await addDoc(collection(db,"orders"),{
  name,mobile,address,
  location,
  items:cart,
  status:"NEW",
  createdAt:serverTimestamp()
 });

 alert("‚úÖ Order placed successfully!");
 cart={};renderCart();
};
</script>

</body>
</html>
